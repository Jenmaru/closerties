{"version":3,"file":"RollbarContext.js","sources":["../src/rollbar-context.js"],"sourcesContent":["import { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Context, getRollbarFromContext } from './provider';\n\nexport class RollbarContext extends Component {\n  static propTypes = {\n    context: PropTypes.string.isRequired,\n    onRender: PropTypes.bool,\n    children: PropTypes.node,\n  }\n\n  static defaultProps = {\n    onRender: false,\n  }\n\n  static contextType = Context;\n\n  firstRender = true;\n\n  constructor(props) {\n    super(props);\n    this.state = { previousContext: null };\n  }\n\n  changeContext = (storePrevious = true) => {\n    const rollbar = getRollbarFromContext(this.context);\n    const { context } = this.props;\n    if (storePrevious) {\n      this.setState({ previousContext: rollbar.options.payload.context });\n    }\n    rollbar.configure({ payload: { context }});\n  }\n\n  componentDidMount() {\n    const { onRender } = this.props;\n    if (!onRender) {\n      this.changeContext(true);\n    }\n  }\n\n  componentDidUpdate() {\n    const { onRender } = this.props;\n    if (!onRender) {\n      this.changeContext(false);\n    }\n  }\n\n  componentWillUnmount() {\n    const rollbar = getRollbarFromContext(this.context);\n    const { previousContext } = this.state;\n    rollbar.configure({ payload: { context: previousContext }});\n  }\n\n  render() {\n    const { onRender } = this.props;\n    if (onRender && this.firstRender) {\n      this.changeContext(true);\n    }\n    this.firstRender = false;\n    return this.props.children;\n  }\n}\n"],"names":["RollbarContext","props","storePrevious","rollbar","getRollbarFromContext","context","setState","previousContext","options","payload","configure","state","onRender","changeContext","firstRender","children","Component","PropTypes","string","isRequired","bool","node","Context"],"mappings":";;;;;;;;;;;;;;;;IAIaA,cAAb;AAAA;;AAAA;;AAeE,0BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,sHAFL,IAEK;;AAAA,wHAKH,YAA0B;AAAA,UAAzBC,aAAyB,uEAAT,IAAS;AACxC,UAAMC,OAAO,GAAGC,8BAAqB,CAAC,MAAKC,OAAN,CAArC;AACA,UAAQA,OAAR,GAAoB,MAAKJ,KAAzB,CAAQI,OAAR;;AACA,UAAIH,aAAJ,EAAmB;AACjB,cAAKI,QAAL,CAAc;AAAEC,UAAAA,eAAe,EAAEJ,OAAO,CAACK,OAAR,CAAgBC,OAAhB,CAAwBJ;AAA3C,SAAd;AACD;;AACDF,MAAAA,OAAO,CAACO,SAAR,CAAkB;AAAED,QAAAA,OAAO,EAAE;AAAEJ,UAAAA,OAAO,EAAPA;AAAF;AAAX,OAAlB;AACD,KAZkB;;AAEjB,UAAKM,KAAL,GAAa;AAAEJ,MAAAA,eAAe,EAAE;AAAnB,KAAb;AAFiB;AAGlB;;AAlBH;AAAA;AAAA,WA6BE,6BAAoB;AAClB,UAAQK,QAAR,GAAqB,KAAKX,KAA1B,CAAQW,QAAR;;AACA,UAAI,CAACA,QAAL,EAAe;AACb,aAAKC,aAAL,CAAmB,IAAnB;AACD;AACF;AAlCH;AAAA;AAAA,WAoCE,8BAAqB;AACnB,UAAQD,QAAR,GAAqB,KAAKX,KAA1B,CAAQW,QAAR;;AACA,UAAI,CAACA,QAAL,EAAe;AACb,aAAKC,aAAL,CAAmB,KAAnB;AACD;AACF;AAzCH;AAAA;AAAA,WA2CE,gCAAuB;AACrB,UAAMV,OAAO,GAAGC,8BAAqB,CAAC,KAAKC,OAAN,CAArC;AACA,UAAQE,eAAR,GAA4B,KAAKI,KAAjC,CAAQJ,eAAR;AACAJ,MAAAA,OAAO,CAACO,SAAR,CAAkB;AAAED,QAAAA,OAAO,EAAE;AAAEJ,UAAAA,OAAO,EAAEE;AAAX;AAAX,OAAlB;AACD;AA/CH;AAAA;AAAA,WAiDE,kBAAS;AACP,UAAQK,QAAR,GAAqB,KAAKX,KAA1B,CAAQW,QAAR;;AACA,UAAIA,QAAQ,IAAI,KAAKE,WAArB,EAAkC;AAChC,aAAKD,aAAL,CAAmB,IAAnB;AACD;;AACD,WAAKC,WAAL,GAAmB,KAAnB;AACA,aAAO,KAAKb,KAAL,CAAWc,QAAlB;AACD;AAxDH;;AAAA;AAAA,EAAoCC,eAApC;;0CAAahB,6BACQ;AACjBK,EAAAA,OAAO,EAAEY,6BAAS,CAACC,MAAV,CAAiBC,UADT;AAEjBP,EAAAA,QAAQ,EAAEK,6BAAS,CAACG,IAFH;AAGjBL,EAAAA,QAAQ,EAAEE,6BAAS,CAACI;AAHH;;0CADRrB,gCAOW;AACpBY,EAAAA,QAAQ,EAAE;AADU;;0CAPXZ,+BAWUsB;;;;"}