{"ast":null,"code":"var _jsxFileName = \"/home/jenmaru/hexletproject/frontend-project-12/frontend/src/contexts/chatContext.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { actions as messagesActions } from '../slices/Messages.js';\nimport { actions as channelsActions } from '../slices/Channels.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatContext = /*#__PURE__*/createContext({});\nconst ChatProvider = ({\n  socket,\n  children\n}) => {\n  _s();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    socket.on('newMessage', message => {\n      dispatch(messagesActions.addMessage(message));\n    });\n    socket.on('newChannel', channel => {\n      dispatch(channelsActions.addChannel(channel));\n    });\n    socket.on('removeChannel', payload => {\n      dispatch(channelsActions.removeChannel(payload.id));\n    });\n    socket.on('renameChannel', payload => {\n      dispatch(channelsActions.renameChannel({\n        id: payload.id,\n        changes: payload\n      }));\n    });\n  }, [dispatch, socket]);\n  const staticSocket = (action, value) => new Promise((resolve, reject) => {\n    socket.timeout(1000).emit(action, value, (err, response) => {\n      if ((response === null || response === void 0 ? void 0 : response.status) === 'ok') {\n        resolve(response);\n      } else {\n        reject(err);\n      }\n    });\n  });\n  const sendNewMessage = message => staticSocket('newMessage', message);\n  const createChannel = name => staticSocket('newChannel', {\n    name\n  }).then(response => response.data).then(data => setTimeout(dispatch(channelsActions.setChannelId(data.id)), 100));\n  const removeChannel = id => staticSocket('removeChannel', {\n    id\n  });\n  const renameChannel = (id, name) => staticSocket('renameChannel', {\n    id,\n    name\n  });\n  return /*#__PURE__*/_jsxDEV(ChatContext.Provider, {\n    value: {\n      sendNewMessage,\n      createChannel,\n      removeChannel,\n      renameChannel\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatProvider, \"rAh3tY+Iv6hWC9AI4Dm+rCbkwNE=\", false, function () {\n  return [useDispatch];\n});\n_c = ChatProvider;\nexport { ChatProvider };\nexport default ChatContext;\nvar _c;\n$RefreshReg$(_c, \"ChatProvider\");","map":{"version":3,"names":["createContext","useEffect","useDispatch","actions","messagesActions","channelsActions","jsxDEV","_jsxDEV","ChatContext","ChatProvider","socket","children","_s","dispatch","on","message","addMessage","channel","addChannel","payload","removeChannel","id","renameChannel","changes","staticSocket","action","value","Promise","resolve","reject","timeout","emit","err","response","status","sendNewMessage","createChannel","name","then","data","setTimeout","setChannelId","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/jenmaru/hexletproject/frontend-project-12/frontend/src/contexts/chatContext.jsx"],"sourcesContent":["import {\n  createContext, useEffect,\n} from 'react';\nimport { useDispatch } from 'react-redux';\nimport { actions as messagesActions } from '../slices/Messages.js';\nimport { actions as channelsActions } from '../slices/Channels.js';\n\nconst ChatContext = createContext({});\n\nconst ChatProvider = ({ socket, children }) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    socket.on('newMessage', (message) => {\n      dispatch(messagesActions.addMessage(message));\n    });\n\n    socket.on('newChannel', (channel) => {\n      dispatch(channelsActions.addChannel(channel));\n    });\n\n    socket.on('removeChannel', (payload) => {\n      dispatch(channelsActions.removeChannel(payload.id));\n    });\n\n    socket.on('renameChannel', (payload) => {\n      dispatch(channelsActions.renameChannel({ id: payload.id, changes: payload }));\n    });\n  }, [dispatch, socket]);\n\n  const staticSocket = (action, value) => (new Promise((resolve, reject) => {\n    socket.timeout(1000).emit(action, value, (err, response) => {\n      if (response?.status === 'ok') {\n        resolve(response);\n      } else {\n        reject(err);\n      }\n    });\n  }));\n\n  const sendNewMessage = (message) => staticSocket('newMessage', message);\n  const createChannel = (name) => staticSocket('newChannel', { name })\n    .then((response) => response.data)\n    .then((data) => setTimeout(dispatch(channelsActions.setChannelId(data.id)), 100));\n  const removeChannel = (id) => staticSocket('removeChannel', { id });\n  const renameChannel = (id, name) => staticSocket('renameChannel', { id, name });\n\n  return (\n    <ChatContext.Provider value={{\n      sendNewMessage,\n      createChannel,\n      removeChannel,\n      renameChannel,\n    }}\n    >\n      {children}\n    </ChatContext.Provider>\n  );\n};\n\nexport { ChatProvider };\nexport default ChatContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}